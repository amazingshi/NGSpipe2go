# DNA-Seq pipeline
Here we provide the tools to perform paired end or single read DNA-Seq analysis including raw data quality control, read mapping, variant calling and variant filtering. 


## Pipeline Workflow
All analysis steps are illustrated in the pipeline [flowchart](https://viewer.diagrams.net/?tags=%7B%7D&highlight=0000ff&edit=_blank&layers=1&nav=1&title=NGSpipe2go_DNAseq_pipeline.html#R7R1bd5pK99e4VvOgCxFvjzGJpv3anjbp5fS8dCGMSoNAAU3SX%2F%2FNFQcYcFAETNo%2BRIZhGPbes2ffp9W7Wj%2FNfN1bfXBNYLdUxXxq9a5bqtrt9fvwD2p5Ji0jTSMNS98yaaddw731B9BGhbZuLBMEsY6h69qh5cUbDddxgBHG2nTfdx%2Fj3RauHX%2Brpy9BquHe0O1063fLDFe0tTsY727cAmu5oq8eqUNyY64bD0vf3Tj0fY7rAHJnrbNh6DcGK910H7mm3k2rd%2BW7bkh%2BrZ%2BugI3AyiBGnptm3I2m7AMnlHlga3z8fP99825z%2Fee%2FL2%2B%2FTH8E2%2F%2FaXYaBrW5vKDBa6sCGI05Ma4vAa1tLB98Y%2FN6guU58DIfoEv5a0r%2F4sbmfbIFzwmOxVgyN8JkBfxWubfirC%2B%2FZ%2BhzYkwimV67t%2BrhTb4r%2FwS5B6LsPEZYgFCcL1wkpSXUHaN56sAImHRGPE10tLNvmBr0ZoP%2FRoOwORmJvsvR104LATTQb7toy4KWCuth6ENDfEX6V6CN55FB8bYEfgieuiSJrBtw1CP1n2IXeVUf0Ebqmun2KqscdhWoKJdAVR5wD1lGnq2IZjb0jD%2FiDUoiYWm6Vd4vVx1Fob1d384%2B399Off27bf4nlJMTiu6EeWi4CXHtcEvWM%2BsMY9bTHaop6uiM1TT2aoh5PPTezD7PLcPxp%2FajOZvrP4Op%2Fz%2B%2FawxQygQm5ML10%2FXDlLl1Ht292rRxGEFx2fd67rkfR9AuE4TNFqb4JXdjEEQl4ssJ%2F0eOdPr36wd25fqIj44tnhpwU1WQiJHA3vgFyGGyPLtBQ95cgzOmo0bWFYJKLYB%2FYkFq28Z3rGGT9cj9%2F9ZT7m%2F5ofq3M1t6%2F5g%2B7rarngi2IEv%2BZewhd%2FuDv7R7DV%2FuwnEDAgWhPY10M5lqRzMS2c0JyDMWdXmEkxxj%2BaTEu7terFeODl47xGH4bscYrw3jeLAUiGxKFYqTAhDR0ox1gZF7CDl3Ne8qR4KKGK7V1Obn%2BeNm%2BB78RSC0P2BaUgmD7hBfv5lJCIJldvJkImUdO%2BLjPbmPqsUJ9Dp%2FmPhLqvmBhORaW4yBKnD2fUg7wA09HbzOoZLnraARBO%2FQ3jqGHaG78ZZsSrGBQhZs0GVoKLY38FjKojqRbHyxiA67CENkVLtHCUqdLK4SaRMe3vY6Dhppa6%2FnChcPCnx9n9wjD6tKFF21Eu7Y7RxoK2CILyJShP4C%2FIeUHiPCnpqPDHx12rwPVE3f7nJ5jZj8Ga10A%2FwJoSWpSjVpDtqubATKgoM9H5hLX3NgIjorumGiNBQFkyJZuE%2BasQ2YI%2FHP%2BYPAEjE2Iv5BjGpDQ0LCWs8Ts5E0ALuAf3Ojplg8wKDBA3nj4lgkCpGIfAohylmnqldkKeilGECWmxrIReBsIs0rwWmxk1yp9P9UE%2B2kCBFC599BPqPx7roM%2FnghITBAZsYbIpqgJwZW7oUvDMA0yVQAx1iYtldD3fXItTFb0ZW21H0PYMD6Au1gEiMkmkBBN%2BnC8qKM6JVv2%2B0dMyi0m2Ubaa0GF9RDZlVHtfnWlIqvE1wD4%2F8x%2FIeM%2B3ByQZS8urHpCzrWG04eiFmZbCuJaxHqmkPZ2iLCI7g24e3DVhG1qqET3DAg8vLXsE3A%2F7di2aEeSE2u9ZNsq1eugT7XBIiQ3R2LuzYt3IiGiDkkp2uQ7W90PMgWlrG4HyEkp8J8G2GRsizV4vru1TCAh1lh5RDSJ5KSP8MEYMPBkct5LHmsHHjCshWXE3668yZtBdoPrhR3RkxeyHyRCi7qX0ascB6I7A8f0mQuC4Gjiwn1yYWNTO7Lnx7n348oKwb2nY1b56OteSUJL3HGjjvuCHVgktChaYb4JLznWWWS%2FFBkGKhVk2AsbK8loMTQmcFOKJDN%2B548eHqbGg%2F1l0tavZ13Qfd%2Fu1mqVrUKSkbLRHWSSk7bCDhoi10RSw1QPws9XmJHLiBS%2FN5DRhWiGBtTGfBdRlbtAE9Yf8bSxeo0mC3fdB6aaHbubr%2BEk0Y4xjdR11BWphPDGb6Ozgq9F9%2Fcy8ZhNNM3ERYwnwdjhBm9Atfk9vrruDTLYOfb30oGVOMWXwOn7zP%2FOfPSjNKvvDgQ86gAXvQynF%2FKTV%2BvJO4iDaJIcRGscB5l8v5RmHzHjGGm6g2sXi7ieB9cVJ07uj9FIjfUmAJEZC1xkPVYBd4pUjfmjXoA7aRVxp5KNZSzGgwmezNtXEzfK3XkFDqn9uhi2TFKNTDlAp%2F9nE3obtI5QhCDssFsu3FpRfht5i6g%2BJZ6QNVpY0WdYxGZOzMho3sobKkgwQ%2Frs8sv%2FMLh9S8fiLUCQx%2FFGF7krPKGTcfSPKNIydPuS0jw2syRXQFrx4kOvWCjWVF9bNiLXW2BvARq1Eg1tqI1iK6U3Tq8UoYo2GBReKZLLYtiwZaGkVoYPgo0dBs1cG1tjwa2HRwtiMSJ67HPxQRuSrI09KvPn3cK41T3bDZ89cIXu%2BtG6%2BYW0weQjwMFdZ9%2BupkHeN5%2FiC799vn%2F%2FzzUa2HB9UPnrdcdBYYoYGDFg%2F2UhxDwwHHRk7TzdHutaPh8ZNZ6P2O6yoUwEzqzNWIjhwpVvEHon2yvQDcRU2C7cLCo%2FAUUPFJG9TbQpluBrFUYMMydu8y1hZaqgLBJ4rwo6rkoFlfSMZ2cHNEWy94EHCaKh3CfuozuxPw6lVyEFOYLINFhZzvNPEpT0kzRDDfYn6gjvUlGKtHfu1qZABBN0yXTRJf1azf7sDu4F73ZWwPaAH3TuMr9f3DfPV1mJ%2FPYJzggyo2gRoKXiu%2BtWPBwJbX6dlsCV%2BME1rQXiJRivuONOzjY2QYiH0iGffQ6soMX5F3cxXSFEbLCC6zMg7EdVHAAQq85xFzZlf61IihwMx5IypFrCpitOSag1kKaMPJ1SoruZfXe%2FIVgTY7iagH6WX9R8ESnLWageGvdULZoJoI9AM3700vf1Z66Dh6wMATdywgmtMdmaGar6Gk8y%2B%2Ft3hwkSIzOQdFhL%2Bx7u1tcbukXLuB8%2B6P4D3oXXkDvDoc2NZ1sGtS5U7bv01%2FD1gbx3gJDM2XsHeupIYLCo3VvZ7Z07Q6st%2BqEvqzg2L%2FrhG5Gdb6DuWMCH2UesY37%2F8VNLRQ6PJTXPYuuNY7i%2BqTsQYPgeCI1OJTwl8jhSdQC5W%2BR5S19pnSNv6Xfj247GRNaaOItYsK2Vs5x9SrMmHRkxqlUgPvs8gJoFYlk0N0Mg1mi%2BSdME4okegDtgQOY892lxD8ltbfcU2sjQOPDPZxzuZ2HPBMotVSaXH1qRC67sbY1ZywS7ms9%2FU4d0iCLy94vOLyOwpu7tbT7cmDP3478eWLc%2F343DsTEbtF981HCZovJImstVJCnLuVjYtA9ysZw8QeoOLABEBRK5cajEGsgK8s1wvaAASsReTfCEDRHL2DckPRY0fuQOUGJTlTlcTCSNF7LEDtZNAsfrbI3FBXn3g%2BM%2BOi0%2BGKtQDEUtGUvU0m%2B7Bmb50Qa0LynroMSfhuXxxLn%2BoCswl4wFBdi63fGp1n9fsP4TgDtt0k7EgV5v0s5%2FwLG297frxffeenE32n79Grbb3TQiim6%2FvzZrj%2FVfYhouTd2M9uBC6ma3wg15LLDDCwE9btSGPM6OZs6qOzF3n1CxBRRjjxny3PVN4Ldhc8S06VrBxRiQqNmP7vD1RklwVQ9o6H%2FUw9NNMxpblarcE3fcY2LKD5AQBP%2Bzgjjp783%2BmGTdCbDmJwvlDtum4n5sQCXVK%2Fpmrpea%2FeHh3DWfU42p7Sk0WQsBSTzsGm3zkMwh6kiIGPGlC2IgmJP8wbFC%2F2J3vbAcnAYchdWS%2FC0dE50ovYs40TkXexACL%2BAzcHczTn9D7jac7oYa0xDJgVHB8V%2FJxFCjiNpQO1kx5YY2nF4oGg%2FjBpXBWEtLRSPBDj8uIWDhz%2Ffw%2Bovy73%2Fvpnc3%2Frprfpk9v233z6aw6KGaL2Qzl6jKNZLqUHksVFIWNU4x0kv3I3WZoHtm2nE071oiEN86MgGI%2BqOph%2Fqe%2FbUmLRgn8e6UUuXNH8vzgHmRN7NKtFFHX5OURLgZbpHWiWvsLdJlsmI21j2xZBXOP9DXng26nbtuB8O4s%2FzT7HmqB8yznA2sptj3ZMmOtH03o2LHqcqMsbiuxgRTp%2FM4UKZwLHizQaxsrq85RoYFa5q%2BgYRmxNuiPGcUHRDFH%2BG9au2iMAR8g7pfYl6Pv2mThSvbjEbHLxOxt7ebAnNtXo%2FhYW6PYa3u3jE7bkWuPn2NIUI4rP4uJ4GDk7iihRnZ5g3X3NXbhDzkwSSmeBYMX7YLNS8yiCUIoC%2BRDw0a82vzfH2nQ1WgL1boOxUfbJK52ab2tOOqqL4HS1zONSLfjPKt88xdBO3hcSQJzyPhDy%2BhTYwa6K7fmyQ3pLVlmphBiqgizjRL2UziJ5So6RR8TbSXlJH4ICSCOjPwLaI8Tt2E5NVIX2nTpZ8SiDNp5eqyQk8819IE1KmVUCBCSJ3Zed2RXvY2hOA0%2BM1xp7JhfG4CXOCAEluUffViOcwoUZ2rP5JD4slYTFqpuybB4Fj4oNFdJtNERE4AbPN%2FySiL%2B2%2B7g7GoqoIQaSU43YWBVVpzVIxGBVYJgSWrTvytKx2JeFxdabjOF9Zy47NQmyaaVirN1yYAQe2oW4dcZhaKFneqPfW6Hoh5PtDXc5TPnQUuQY8GwCoh1MSBJzJD11G5HNcRyARs4m62uJwCc3axbXy8EM65d%2F0HdHoKBqmjL7FIt8dMX6Co9%2F4Gn0Y8BgXem1thvNgEISD0jY3YuUVnQKEf2Bs%2FFkGCDLgWMv06Li%2FuKsH%2BlwBcKQ8f2ULP%2F2TDokBIO4Zyqe9CgR8kgEN0N1movYULlpHFGT1ISlLEIjHfYHPWA8Am7R1gAihaWM4yuBCWZ89W13LFoHzzUwMiExI%2BHI2dPbLXiTMoLlbIWJqEUFQFalxCuiwtgDNPQHs98Zv7JEBBMFskbdEiYF%2FgyvsG%2FACvuqIldsXxclwTfcluhW%2FZq5i9mhmpxQNWYLpeWwGKs9Md4G4CLGTgKeMqOT%2FZdIWmbCEN8gmC52PJTia5CiOfKrRkC0um1ZzjWkhdhRefgG%2BRU0gSKmwUe3xkTuRBOqxs%2BBNznjXkzOZezYe7lob8pIf0QNwXdZBKE8NepnZK1OfOUkqu2Pj288TXjQf0PfsY544%2ByFXiqPoC606e02qjhCg3SotyLMeGZ7Q9dqB9%2BUsrDc7Gx5jWUztg%2FK471ewf72efJ4vvX2ZWd%2FN91BasIXGJhmNzyo9CstagYJJqLb2nQnJOqfO6Cwf0qYdPtnBAn54tdKLCAXlaCM6ltYzgevJ2jRWB0lUQOq6q0MrmCgSF26JZvPjNVSkfOaUHaG4NKsn%2BdZZXeiCbOs9O50hGz%2FS1ekt2ibl2raUHzmlzzKmXE2ece0m4%2Bs3xbGpx1705SiO5wbujNh41aXeM9jhaJw6d1XErf1jeFUmq5I4D2QQkoSR1%2BkcFxjTRhnZ7VaD%2B5Hmaz1JFdIa9WrcyYYBO%2BlBU7FNu7RwzEsb6%2FdAuAZzDUTwWn0GOh6bIUK8Vh6Yc6M4wE56m4E5JPncx6flFJ7znAuPVJnM3dmKt%2BrLMS%2BBk40E8THMgOLVQFPDX047nZOJjZ7LTAfaHvAySkeDc0mWA5aIJEIhF61ZfI0w48wD98fgIMbbPJPqkr5Vc0hJGjxWYYYKSGuD%2FT%2B6I4phtVbAllhCzLSYkVUBIEgLEQd7%2BfFJ%2BNe5%2BuZoRe2oBA3vuPjZWkT3AGZquLZW54Mo7IpnlMJfnHi1Ft%2B31lQRJFdJV5eqBHV%2BFuNRyYA0OIxeCrydLYsOySew4I1mtp7HUWfOtqJFMFutib%2ByJjtzZZ4aiuZ8L3YjLf7s8tP3R%2FqyBJCQLc0uLjE8NYvfoTNgWqkbKl5zem2Yam0SWNU3JOHlWKFbGX1SDNe0nnuTPeJ1qkW0tmwJLNq2dXvJNRaaJKpVWaFrLK9yYaR9Kqx4%2BnmixBNSUc5JDH4cIvLgnkQmJJcW11N4U%2FxNyOj4XFSE2dpBLPE6Gz7SDg94M0P9WRlre0tdNC2I%2F0Wwg1ytlu0tU9oux4JVuYs1KacUCckpKwUumvmo9gWVxLNIJ1BIONRYXV81WyLNoJ1Oxxk9t7GSLvUtv0B%2FhiKRKlzAFE3kM%2BNwsOxVZv2txPYQcXOdRN3UPMy8l9K01KWiVQ8h5o6ITsloo%2FYOWsIFEDokgCOPJv3kj7CpQs4PRyUC0NqXM2egIJqnnRAekF%2F48OKyxsUkObGrvoSHRiw2Uk%2FCU4FKDYCXTwIV%2Bdm6eoiha6b4pM2LhL6Lw5E854quAH4E%2BsFgQcYWez85t%2B5KzhI3p5bCHkx6fb0y3y3qzjcdaL87q%2BmlWJzR%2FdFlAYvmnb%2F51s0tqEGLwyeqNdWqJIqtgwz1lKTWGQDjohE98XkpKy3mFvjNSRLG1M7%2FDaTnij0U8rh0QJndJ9mLhRCDGxnGgkjEzkhejGTh67AgOuSMZpJxVUiOJqKEEVxvvra0KtpXjkJYYJxhU3jgoGjPYLBaWAQK%2BIOsLwWnzZ1%2BjjzXbapASdQS7ZnZATjzJojsUVMcRHW9ysiQLteb8pfOJIxWDT7r2Sk3m02j1XW1CrA0jzgbVr85F4Yh2Tqi4LKZXV506S86YNugXCy2ROdisI8rvOKaSiPLrjrSaT5kWO2pe%2FCnTp2U1Y1lW04ho5oFWaa6PJAnWemxFKaWLe02jwb0%2Bneo9wg06jvjQAtVNw7LYJ3yi%2BtRyaO43aD95KWgWbij9WtE8aJB19qWgWbyaT5Trdmwa7s65VXoOLnOqLclrOPcTc9Hh4mVSvqjGp%2Bjuz%2F4%2FX5Wn7ugLsRzyaqvYlsK4WAzE6RWe8hhXc6PVppYdlhuilssNM0bOZ8dHfCUKI2iTIAJZhi0zxer5uDCWrihXjwnmlcbUHcXVkzF1jay8UO%2FRl1Vw9ViM3WlZvHTM%2BaAeFh%2Fxuyk6m%2B%2Fe8AFwpMVQtLwgu8Lz4yPHSDQVCm5DZyzq1KxWkVUcHzIY4A%2BRN4z3ThGjK2IiONyTDqyULjX2WXYaO%2F6mL0h7rJu%2FaLV65M5fapTOlPorNeaMHzjezWLxIkVFGrUJWnw4KInpfL0CI%2B%2BePl%2BBURumU2lrZ%2Bj9WhPUXpjAKF3wsCaBMc%2BYeUUqeHP1lLjAiYxIKTkuGD35AU4fhbTni6jxcXe10Nf06Rq4GNjqdnGuVVuBwVLF0J46qjZeAzZBEIdc9xn8ztUHuJejh%2F4P). In case of paired end reads, corresponding fastq files should be named using *.R1.fastq.gz* and *.R2.fastq.gz* suffixes. Specify the desired analysis details for your data in the *essential.vars.groovy* file (see below) and run the pipeline *dnaseq.pipeline.groovy* as described [here](https://gitlab.rlp.net/imbforge/NGSpipe2go/-/blob/master/README.md). A markdown file *variantreport.Rmd* will be generated in the output reports folder after running the pipeline. Subsequently, the *variantreport.Rmd* file can be converted to a final html report using the *knitr* R-package.
GATK requires chromosomes in bam files to be karyotypically ordered. Best you use an ordered genome fasta file as reference for the pipeline (assigned in *essential.vars.groovy*, see below).


### The pipelines includes
- Quality control of rawdata with FastQC
- Optional adapter trimming with Cutadapt
- Read mapping to the reference genome using BWA
- identify and remove duplicate reads with Picard MarkDuplicates
- generation of bigWig tracks for visualization of alignment
- Recalibrate Base Qualities in BAM files using GATK
- Variant pre-calling using GATK HaplotypeCaller and joint genotyping with GATK GenotypeGVCFs
- Calculate VQSLOD scores for further filtering variants using GATK VariantRecalibrator and ApplyRecalibration
- Hard filtering variants with user-defined thresholds using GATK VariantFiltration
- Calculate the basic properties of variants as triplets for "all", "known" ,"novel" variants in comparison to dbSNP using GATK VariantEval
- Annotation of the effects of genetic variants with snpEff


### Pipeline parameter settings
- targets.txt: tab-separated txt-file giving information about the analyzed samples. The following columns are required 
  - sample: sample identifier for use in plots and and tables
  - file: full name of sample file without suffices (sample file name itself must not contain dots)
- essential.vars.groovy: essential parameter describing the experiment including: 
  - ESSENTIAL_PROJECT: your project folder name
  - ESSENTIAL_BWA_REF: path to BWA indexed reference genome
  - ESSENTIAL_CALL_REGION: path to bed file containing regions to limit variant calling to
  - ESSENTIAL_PAIRED: either paired end ("yes") or single end ("no") design
  - ESSENTIAL_FILTERVARIANTS: either "VQSR", "hard-filter" or empty for variant filtering. VQSR is recommended if possible. If required reference datasets are not available, apply hard-filtering and select appropriate thresholds in *VariantFiltration.header*.
  - ESSENTIAL_KNOWN_VARIANTS: dbSNP from GATK resource bundle (crucial for BaseQualityRecalibration step)
  - ESSENTIAL_HAPMAP_VARIANTS: variants provided by the GATK bundle (essential for Variant Score Recalibration)
  - ESSENTIAL_OMNI_VARIANTS: variants provided by the GATK bundle (essential for Variant Score Recalibration)
  - ESSENTIAL_MILLS_VARIANTS: variants provided by the GATK bundle (essential for Variant Score Recalibration)
  - ESSENTIAL_THOUSAND_GENOMES_VARIANTS: variants provided by the GATK bundle (essential for Variant Score Recalibration)
  - ESSENTIAL_ADAPTER_SEQUENCE: adapter sequence to trim with Cutadapt (optional)
  - ESSENTIAL_BASEQUALCUTOFF: base quality threshold to trim low-quality ends from reads with Cutadapt. If *ESSENTIAL_NEXTSEQTRIM* is true, qualities of terminal G bases are ignored. To switch off base quality trimming in Cutadapt entirely, set *ESSENTIAL_BASEQUALCUTOFF=0* and *ESSENTIAL_NEXTSEQTRIM=false*.
  - ESSENTIAL_NEXTSEQTRIM: most Illumina instruments use a two-color chemistry like the NextSeq (exceptions: MiSeq, HiSeq). This option accounts for terminal high quality G bases incorporated by faulty dark cycles during base quality trimming with Cutadapt.
- additional (more specialized) parameter can be given in the var.groovy-files of the individual pipeline modules 


## Programs required
- Bedtools
- BWA
- Cutadapt (optional)
- FastQC
- FastQScreen (optional)
- GATK > v4.0
- Picard
- Samtools
- snpEff (optional)
- vcftools
