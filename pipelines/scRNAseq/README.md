# scRNA-Seq pipelines

Here we forge the tools to analyze single cell RNA-Seq experiments. The analysis workflow is based on the Bioconductor package *scater* and the Bioconductor workshop published in F1000 Research: Lun, A. T. L., McCarthy, D. J., & Marioni, J. C. (2016). *A step-by-step workflow for low-level analysis of single-cell RNA-seq data.* F1000Research, 5(0), 2122. http://doi.org/10.12688/f1000research.9501.1.

The pipelines usually include:
- FastQC
- Mapping to the genome using STAR
- Quantification with featureCounts (Subread) and UMI-tools (if UMIs are used)
- Downstream analysis in R using a pre-designed markdown report file (*sc.report.Rmd*). Modify this file to fit your custom parameter and thresholds and render it to your final html report.

The Rmd file use, among others, the following tools and methods:
- QC: the [scater](http://bioconductor.org/packages/release/bioc/html/scater.html) package.
- Normalization: the [scran](http://bioconductor.org/packages/release/bioc/html/scran.html) package.
- Differential expression analysis: the [scde](http://bioconductor.org/packages/release/bioc/html/scde.html) package.
- Trajectory analysis (pseudotime): the [monocle](https://bioconductor.org/packages/release/bioc/html/monocle.html) package.

Programs required
- FastQC
- STAR
- Samtools
- Bedtools
- Subread
- Picard
- UCSC utilities
- RSeQC
- UMI-tools
- R

## MARS-Seq (massively parallel single-cell RNA-sequencing)
The protocol is based on the publications of Jaitin, D. A., et al. (2014). *Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types.* Science (New York, N.Y.), 343(6172), 776–779. https://doi.org/10.1126/science.1247651 and Keren-Shaul, H., et al. (2019). *MARS-seq2.0: an experimental and analytical pipeline for indexed sorting combined with single-cell RNA sequencing.* Nature Protocols. https://doi.org/10.1038/s41596-019-0164-4.

The MARS-Seq library preparation protocol is given [here](https://github.com/imbforge/NGSpipe2go/blob/master/resources/MARS-Seq_protocol_Step-by-Step_MML.pdf). The sequencing reads are demultiplexed according to the respective pool barcodes before they are used as input for the analysis pipeline. All analysis steps are illustrated in the pipeline [flowchart](https://www.draw.io/?lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&title=NGSpipe2go_MARSseq_pipeline.html#R7V1pd5s4F%2F41PqfvB%2FuwLx%2BTtOlypmknaU%2Bn86VHIGHTYKCAs%2FTXv5KQMIuMsQOGNDOdmRoBQsvVvc9ddDVTL9YPbxMQrz5GEAUzRYIPM%2FX1TFFk1dbwX6TkMS%2BxTDMvWCY%2BZA9tC27834gVSqx040OUVh7MoijI%2FLha6EZhiNysUgaSJLqvPuZFQfWrMViiRsGNC4Jm6TcfZitWKhv29sY75C9X7NOWwvrnAPd2mUSbkH0vjEKU31kDXg3rY7oCMLovFalvZupFEkVZ%2Fmv9cIECMqx8xPL3LnfcLZqcoDDr8sI76YO3urKy4G517Vy9u7n88fvdnE%2FAHQg2bCxmihHgCs%2Bhf0dGN%2FCXIb1h%2FNqQpp4ndBiKS%2Fxryf6mrzlJvQQ3idbFS%2BlgZI987FfZOsC%2FZHwvAA4KzoshvYiCKKEPqZf0H%2FxImiXRbTFJeBDPvSjMGEXJBmk3SFcIshppPcWV5wdBqdI3BvlTVMrv0DlUz5cJgD4e21qxG619F19K5JEApCn7XUyvRD%2BbgcyPyMDNbanodXmy2PzdoSRDD6UiNnlvUbRGWfKIH2F3Ld3IX2FrbG4x4rwvUazJylYlYtUkla0UtkqWRd1bcsE%2FGMWIqefOvfr75tvmw%2Bb173%2B%2FvP9y%2BT29%2B3cu%2F0c%2Bg5BPD9SiWFKFWgpWW6IWTRJQi8EffAq1%2FP6Wvf4i%2FfPvh8vrN8lahl%2FePr6f63Jj8hDEbJhdRkm2ipZRCII329LSDJCB2T7zVxTFbFp%2Boix7ZFMINlmEi0pEgR787B%2Fy%2BkJnV99Ld14%2FsJrpxSO%2FCHF%2FSy%2BRy%2B%2Fle9vX6NX2PXhGpBG%2BdMnckpkmhZd%2BwJvTJMAKwe2c%2BTTaJC5qWYtsjWcgWaKs7Tn2IBn6VkJKUIB52F1VQj6FKD59%2BXT7c2X9%2BPXPl0y5%2FHH1TTacufVcaKI5ccPPlWaNNVdtzd7F7Ktsm%2FDVysRyjk9uzFM6NWf4AVmLHwTi4EKZnZ2vgR%2BSIfZjFPiYfeLC83ZJkX%2B1XYDsbTKHp7xR8m5xlcYgrJcBMrV%2BVuv2GiRpin4teGcWWEhFd4%2Flqvno8xITGqZlG5KOF4WFVN2WXAyBNRWYhuPZjjq3XYQkQ1aQowBVA47iuiqSLAtKGtIg1A2gS65hoMpHVgnyKp9ZZRmB2WeEOJTLpZ%2BtNs4Cyyl84a8dL8JEin9evb0hTVeWEb5wgsghJATSDOFpuOSdSvHv1L2%2BOsM9pff393k%2FgRgiAtldNZ9zIKAD0XQdTjVHE3UvS2NOGYKfAQe%2FXVocWPtCnh%2F6FHcq0iuH3Plfn6tl%2FH4HEYAp5XdpjPVAwvGwDkY6SjSuCG4CQoLPv38I03aY%2BYCwZIB1S965Oem272FcQQUPwHydrL8jOtwDDT4gd5OR8S7R4I6W7MbsA0BdS4B0OagtI11Z6QHpiuW2QFDWhgDj%2FZj8xHw2xpoB6XwOWjjCsHhBYXfQhMPVKqk7j6HcGDJFMGK8rDPcYN%2F7HPmU2tjH5opemTCzWkHkeSmGRfVJKBr9BH1VHxNt8t%2FfK8hznwZS0T%2B26sgODaRPlCorXVWKE6HUrylKPjk%2FiQEQs0qi7ItMDk2W5kQPhKP54TLnaU6UQJTMcTG%2ByFEII3zK8SRM5Xpxp2zhI7ex4o808qd4IgYQFnUrbQKiO1rMxzxdZA8VW0kdIequZZqGp3ierGm27umqKwPdVmzT86CnOXMN2qpmI8uAqqTicgNqqiVrjqkDz3UsR3Vtx8AzNxZC3NHPfIiqN4%2FAdQK5x2FTk0p2k0BdJKJ1ZbhcTKC4AS6lgVKFUuOpglJKTym7ySVzIvjYKGwAuQzykhSs46CQwkLIt324%2BTov8XmBm%2FNUXq0UYsBRqsvvVD8pbLa5pRcOSNwI9t%2BNWr2iDnT81sFdiqMo6L0%2FeaXS%2B9cE7WMGT7hi5BE%2BC%2B4hyAhj8fwAkUn73yidxty%2Bx1lk1bH%2Bhpu1g5JR%2BkUMfL33ilYqvQowkhipW26fJMq7hSvdrMORJ4wy6P76JmHt61Km%2FyM%2FpVculg8JXYv35Euj9JFAlLi%2FPrLqGMfP2UrOdk7ftcVi0V%2FHQEiQaJStCCqRcjY5TJdIoUiAU9RDQUhZO27XW5QSoGaKTkmHIWqe74LgjDnbMqKYnHPXW4A88pkIP%2BUF1DfhUXdEWUW5X%2FkZusEYhtR4n4C4aNfTNPOqYi7rIjVTpJnb9sHKAb4s6QcHKIWFf%2F4%2FpbCLUtjZzzQp14W8x3fxZ2iN1BKKFbPQ85ezFrXRsQ1NlTTXNl1Nh5ILFFv1NOCpuNnItK25qxuyCmUkIRfJhqVrnmK40EH40rVcxdQlBdmKo85GUht3dZQpENW7%2FymOe0VsQ0xSVwLp7n2U3BKrNDFBgxAsqdhMUM4nBKDqhljumG2YBUrwVgaRSwzaZbIksCKMyBshQpifLmZPF8bNkqGAyX8Nezru6RXG9A9ZVMPoBlmMoXwJyqgREs8NnnBPy2TgyT6bdSwUKWvcfD%2FMpYYUbwFHXj6nK4PcM0r3MIFnc7ZazqjcCHPn4K5IO17weetBFvkUnU7MIa6XrRpPHdXVfNmTm5YYI51TdHUoUiocrIs7kKQdYjEcR5csCFVZlTUS3gyBLAPHVDwstjwDorlpm5KtIlnWXYytJEk1LceyZNVCjmwbMoCG6iAAtcEhU%2BEGLwOmvf3NB23XY50hFAO7hxDKMGRRt0cl0Z1PbL8V17qI3FthB20BHd8r%2FGJlkCo9F3w3f430VejCl17lYIjCoMMtSKVR3WtNUNqtCdOzG2ia2tFucETs6vF2A5FKWZPUw3r5%2BQcn6%2BbXqtNYraAXN78wpnTUOONnh5i0iSGmjqtPFGMzGUh17uOlgKX1Go%2BESyKkyG6mcmTaHwmqSCcXRMsnIYhdQJUOLMnTXMNxEYSWRrCSokJLlZFjSNCz5lDToCxDx8F%2FI9uToW0BS5Et0zBNYGpIcU0d2tpIoGpvf%2FNB2%2FXYoXapOhA5coKwtEg7zo8m6S70gOEYimU5CrH9WZ5qO4Ztu56mobluQ83RDUP3JBMB17McCSD8BglEtiwFYMxsW7pjjzg%2FLd0tTU%2FzqSOshmNDW4Dl1WPqc36TIwParRkPIy3IcMZjBdCvjZ%2BQACDJ3aQZGfQGsxLFedQA56Txo24qHfGjNJgVRx8dLGqHjuILAYvqy0OLfW056%2BwLNCZibStg1yUWHH9fUDbbBZP92mCulpEWbmM9eKgVbTYN2yeNDfzwNv9mr1INP4b%2F7%2BEbv9xFXlyIqr0Kfz5POxV%2BEd%2BpMXHmpfqLXr1WjR2sm%2B6lZRVLs75N8xhMVFiEopkNDiUb%2Fdjmu1gFhJtcZbuVnaDAie5PwEmUdlYyHEvoqk3qUt8sgb56liTgsfRATKRMulvsaLW9I5oh1agir%2FFYkSOkEaXdQPFSaKTnqW%2FMrS7X5latbTTJiZS9tZ30p9KQypKf9EVDQtgyoZ0se%2BhoF2xRR4MtXXmUNprJS4xUn03%2BhF73yneerVOBzMZsGUZi%2FPRW8foWrFT4EPm3V%2BrcmM4CPZTPn2CyVHsS4t9UayKiyrr3P8%2F01L5Y%2Fc3d2f1b%2BSb68enc%2FvRVffi8Wt%2FOJ6Sgjsnqa6QyNDcxh2EenTXUmy9n153102vEIvTimIQJDqmJFtbVFI%2Fh4aqoVhrWIVXRnqPCbLm67kdWPcVj27Qxfjy7vpnfkOmStlE%2BNWZCnFylYWY%2BrqoyT4axHp639iGkvKY2I9uSazYO6mxHjiyaJo3GBOZ8gLFr3Cz9HP%2BLx%2B6CSC8dN%2FMCX8vba%2FwveTzJLqIQVw18OrUIk%2Bs9SrNZM61XD0SgWuTjVQtEgwqEdmVVO5gKuoGMFwoJja5MvHcjw9PyJxmNBdrdU0TzcDB%2FkXSEj%2FrTJos3ROiQ5JhkgZ81RA6%2B%2BcttEzjjuaSL6Kmo6IZP5RHuTlJpd5fwqKcHHZfZC88ieAnWfkDo%2FR0K7hCpdXYKZ5fJZVGLWfS0IcvczjIZOpcapJ6gdBNkrREZ4xG7ixl0mcRf3WPINuMuXHIR0R5u1j5z1VIPxIxkgJrDTRz4uZO3PfnTSb3VL35VGjybyt5VefjWx46r0pr8qgyi5USXJG7ZnC9HNwoCDM1pzEQufRBwyfrkQmpaBD4AMevqCUWMGPgqYwLfscxrHM%2FuBb72aLbQ1nZPhvU0gW%2BCiDY5Ue5zbLxf6i7yfi2u17At0M9xVU9zoGlYpmJD0zKgZ%2BqWpJsAaJ6rozmCFm4bMnVFMh0LyoaB%2F5NM5EDg2K6pabYJHAUOvyGYAZ7LYr4u05UfPv5I3SQEKfr1I7%2Fhh8sfeQzc5c5ByEewfvv0UZm4BbQPuBmLFQpilKSL67bZMiUkGzZUVNe1bclWbUmXVVXRkapbigbluQN0z1VdkunLkyVXhwC6toygZ2uSp%2BOJtXVVNXU4zdlqH4xi1oSPTTVq8zNuKGb4BaMh7CihwZal%2FK0UYCxKNFQEXn6MoO8Rfk1plD7INIFZKW6zFP9Z7Czahn5meILTFeaBac7i%2BWaj0lAcFuj5B4J02%2BqGa3pJHSpOkv%2F07b4%2FN%2BuYP88MrSeLUCzy37MPb5PfD%2BrS799Tv8P%2Fx09M4KEeereQkv2uwM5%2BIT%2F0UIIeMMfz13ScOrqIIOEG65zREIs55Ql8L2Ie20gjGgPfSQAj5MF9SLXOHOxO0k4V2ThsJKOqjOtOEoebTCjEaJjA6Arz6VVP0zvqadMLjE43DrElKhifZY8xSo%2FiL9SASWEI3dqMlzsZjMcYnYar1PtwOFvR%2Fwi2okkTDJDmvtDpuyyPPQWoV07S2dXZe1Dtk%2BxzyrMJf5vCHuzOs8ztrmNHzXOGwe3B7Gi6XWFz9ecN7UkR0ocKsx%2B5Q%2B3AYCr6Eo2mIoZ9jJJLBv%2Bt521AeVbayco6crggM56lIKuHW%2BlKMwvX%2BPj4BSbm6ktdNzvyO0ueBL8z5arar9t7woRrz2v2afidA9YXxOBGT7vtyO1czFhoqm7HX37zl6fYxoib6bJmHs7RynG5z4ej1aG5bkxQ42%2FfuvgfMheezVjmYcJRPRUw78wlziD8%2BvH9eX4axhe8YCWyG%2FpXNSZDxDTKDhQAqR8BVzTjDobifA3u2rim40M%2BQDcuU8oGkJoEqKnxWm4ND6r6a04DtHC3MLZjPcki2u7DeZT1LHlUHXUp1hRRl%2Fmno67BrJJ61%2BiR6VkllyhE5xF8xOhG6YxsEq7HMUSEuc4dZT6kNvJBFC6JA%2FUUJknySZIUGTdGOZif5BP37PhJwxxpjYt5xIaqP56f9Ap6Ou%2FvnKahylCnaajCmOMwGxWmPno%2BTx5zxAPGWR6aBh5L48DPsqF3BpZgFO%2FP4dDpz9gfaEjjQqdWY8pkojCbAeBZAtzbiQZh5vYR0mXWSGYLvvNTkh0qBfnB21Pf79ADtdfDpjSBMWOwcHChVjChLfLTF%2BLW88z4y5s9zYy%2F14hEMoUuEbdvURhVDkptEeTj87UcQtB0A3gG8JJ4oI6uZaUT9ShnD4FsQ%2BNZ6UlBPuV99BvLzDt1cG0jXHabEpVFypbTnvrkOMp9Bx0clXV%2FYklQa5CEQ5QyJOHn7J0mCao1ehLUgoe83CSoYi14Qqb%2FQmYeZPqXTyhAbUG4hniX2rS2Ydm78w9M%2FhDEbUxHsV%2BHUlK7qvDSzvHLh6SaJAH%2F9QrTOJ62PIAl983Utj3xvSS3WJSTQ5r5NZbt9KScYr987rkBlNhEWXFz00NpJ0qaoTh9%2BgG%2Bf%2BRReZNt2Gy8M%2FwGQkM231fPRKspN3P3yJZAtFvm07mxeKfPqJbn49zts4OU1tJ2IDcAaeq7s%2FKOoL79W7LcOex%2BUmK5aPcohrn3YZfd0eC%2BdlT6hAxzPLigSJfy24%2Fj6iFq46ihIVjn8aNYPN4RdZPYB5nVMAbs1A3E0FHXTZinVKOjKJAX1%2FIiD4NY%2Fp5yK5UjWvmsrbC1Q0745XhnnPCcrhP2L5AEmZUdzxNiYw5Yb5nYi%2FAiGBUCVu2O2RSHSyoz6takPtwI5in9CNygOEIaxl6CAUzzsGAA07JqJDbQrhWS2OKaZczoGhDAZotgjdzwTVEG5jy3MLoPZ9u8E6RDJ9iwwpJzkD4cHARgl8nj%2BQYBFAxupCCAd9IHb3VlZcHd6tq5endz%2BeP3O342qkBGN4iLyAGhnKubwzSROPsLLQm03RJvXl1DnDk7xRlLTFyaJGESYSLFakWNXMY7cxeLqKLK0XuRdDWo1qQLTRbQRR9JRoRE0Dy52CHre7ZNYdfBK7N%2FyfUxdFZ1TfH0KOUlJXLIaEMN3VOc0EYd45asw3w0t4V0XEXqD1gTKg2dlPxVSh%2B0nZzRseyRAPYQO%2BEAxCXz7C5l6tJE1KUPRF2ndJC2kvfL9Y8Kh%2BUZOs6Ynf4ydwG1LMeX5iNrHYwX6%2FGZbMNGdEX1IGJsQ63iF8EWCB5NWZEwykASZszU7H7uariMara6SQbFvQALXJ04xfhHRJ3GQNR5aIpygnznvGWURHOZ1OI06FKLuJL3GZ5IV3wwOn1tk9LtZYzMm%2Bk1G7S8Czw0GmSIW%2FQ63ypIDTooj22EJPc%2Fkd2i4Awai9Eu%2BhttbKX3p6vobE2IF85%2B7XwVJf5v3D9QfL%2FAGGo%2Fi6ShJGjNRaJYgjjKwczULzDvSDml6bI9JKRstv5uBx%2B%2B%2BO%2FfODc3D9Fj9Pjh%2B6ev865Wa35ewti5R2pHDppM%2Bex6RCHPNDG01ZqdikANEn%2BRcxw6JyCJ4kc6H%2Bkt%2BQQ9AiLPGlDgBFbI4cKAJuy1nxIdBIQo2pBr1itqHisM2YrQlL2b2J6dJbu%2Bc9ccOZGg8FhMvt5HCp86iBHii880xy01R%2Fd8VqaQTR3HGwU7g%2FaS9ZDxUsKJb9rEnufEy9WJV4713Q418%2Ft9c0NOfVsrO9lHN0nweE62apL%2B7GOaW%2FrIr7J8N6f6em4f6DbvzmU1U62dJ6mJQiDUJptVzR4M0OL0KtK4i2vwAyXbUjTth4SjJVkVNntKSVbHPBl60Ckf5mSBg2NX9NrBA5bSqgXUn1cMvUZuTzuoXKiYPpuE8QPzDjFnVSZBSHX1UN2XyrL%2BvK48hZA6q5MXmwxAEGed1UheUs4al6B1dEeMYbQqapxj259YppSi4jFyzbmsi23xUbtJ7tkplfXwKHWKKTD5Kp1wDHOG1Yn1VIOYi8ZJLy%2BcuZoURVVkju7HC2gWxS3URrk0CpQfnxexB9xiP1PUS%2FqPUHKWh9uo47OqWlV2A%2BBK3xjkz2yHz2CZAOjj6agVY65GtpFRMb4km8q4SF8BSKlAqupvPYXw2WZVDGqC7RayKfACKIYy0ORywbwzKOWAkDL61iaolwSFg%2BvvujeJnu4SRPmWYBJfjGXaBoVuvuGJpV4M0B0KWld%2F0Nihsy35QngJre%2BC8p84zivPtxhXj7qmNI1%2FpVnVQ9dWf6NP9S65%2BSywXrDv%2Fn2RszXMwWlzjuzcVZSs8ed%2Fg8qusOLwLYlG0nSr6j0ke8u87UiwPdjw5ybN6Blh%2Ba7tauBg3m2PLNB8WO9A4pOACrqFzg%2FdYLEdAvfRpQFB8Qqk6H8d2%2FWa7hiU0AMe1IS3je0r%2F3xxlk9rNr%2B5elO0%2BevHs8%2FbWej2Fd%2BjmXdIMpf8awlKUz4QxTZ0um2dOGjnNGENFVGsc4Tbxe1CqtkAXNhcL3WXao3V%2FjEBzbZe44ZqkxsKJd0xcbn4EgPjrKxh4G6tPkaQKA9v%2Fg8%3D). Specify desired analysis details for your data in the respective *essential.vars.groovy* file and run the pipeline *marsseq.pipeline.groovy* as described [here](https://github.com/imbforge/NGSpipe2go/blob/master/README.md). Since the analysis will need custom adjustments after initial analysis e.g. for QC thresholding, a customisable *sc.report.Rmd* file will be generated in the output reports folder after running the pipeline. Please go through the steps and modify the default settings where indicated. Subsequently, the *sc.report.Rmd* file can be converted to a final html report using the *knitr* R-package.

## Smart-seq2
Libraries are generated using the [Smart-seq2 kit](http://www.nature.com/nmeth/journal/v10/n11/full/nmeth.2639.html). We usually generate small datasets (<500 cells) that can (and ideally should be) processed with our standard RNAseq pipeline for bulk data.

If other methods based on CEL/Drop/MARS which are more high throughput in terms of cells sequenced, consider doing alignment free quantification such as Salmon or Kallisto.


## Resources
- ./rnaseq/sc_analysis.Rmd is mainly based on the workflow from Lun ATL, McCarthy DJ and Marioni JC. A step-by-step workflow for low-level analysis of single-cell RNA-seq data [version 1; referees: 5 approved with reservations]. F1000Research 2016, 5:2122 (doi: 10.12688/f1000research.9501.1
- QC: the [scater](http://bioconductor.org/packages/release/bioc/html/scater.html) package.
- Normalization: the [scran](http://bioconductor.org/packages/release/bioc/html/scran.html) package.
- Differential expression analysis: the [scde](http://bioconductor.org/packages/release/bioc/html/scde.html) package.
- Trajectory analysis (pseudotime): the [monocle](https://bioconductor.org/packages/release/bioc/html/monocle.html) package.
- A tutorial: https://hemberg-lab.github.io/scRNA.seq.course/index.html
- [Notes of interest](https://hemberg-lab.github.io/scRNA.seq.course/ideal-scrnaseq-pipeline-as-of-oct-2017.html) from the last guys
- Luecken and Theis 2019 [Current best practices in single‐cell RNA‐seq analysis: a tutorial](https://www.embopress.org/doi/10.15252/msb.20188746)


